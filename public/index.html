<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Produk</title>
<style>
body{font-family:sans-serif;padding:20px;background:#f4f4f4;}
.card{background:#fff;padding:20px;margin:10px 0;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
input,button{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:1px solid #ccc;}
.nav{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;padding:10px;background:white;box-shadow:0 -4px 10px rgba(0,0,0,0.1);}
a{text-decoration:none;color:#0062D1;}
h1{text-align:center;}
</style>
</head><body>
<h1>Produk</h1>
<div id='list'></div>
<div class='nav'>
<a href='index.html'>Produk</a><a href='wallet.html'>Wallet</a><a href='orders.html'>Orders</a><a href='profile.html'>Profile</a>
</div>
<script>
auth.onAuthStateChanged(u=>{if(!u)location.href='login.html';load();});
function load(){
 db.collection('products').get().then(s=>{
  list.innerHTML='';
  s.forEach(d=>{
   let p=d.data();
   list.innerHTML+=`<div class='card'><b>${p.name}</b><br>Rp${p.price}<br><button onclick="order('${p.name}',${p.price})">Beli</button></div>`;
  });
 });
}
function order(name,price){
 let uid=auth.currentUser.uid;
 db.collection('users').doc(uid).get().then(u=>{
  let saldo=u.data().balance;
  if(saldo<price) return alert('Saldo kurang');
  db.collection('users').doc(uid).update({balance:saldo-price});
  db.collection('orders').add({
    userId:uid, productName:name, price:price, status:'pending',
    adminProduct:'', userReceived:false, dataOrder:Date.now()
  });
  alert('Order dibuat');
});
}
</script>

<script src='https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js'></script>
<script src='https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js'></script>
<script src='https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js'></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBpsfDmupS9wq-iNge5aYvknmw5bSryd3A",
  authDomain: "toko-barmods.firebaseapp.com",
  projectId: "toko-barmods",
  storageBucket: "toko-barmods.firebasestorage.app",
  messagingSenderId: "284047189012",
  appId: "1:284047189012:web:6ef0c6891adab08a383301"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
</script>
</body></html>
