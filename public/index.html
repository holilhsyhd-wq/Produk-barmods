<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Barmods Digital Store</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    header {
      background: #0b57d0;
      padding: 16px;
      text-align: center;
      color: white;
      font-size: 22px;
      font-weight: 600;
    }
    .nav-filter {
      display: flex;
      gap: 12px;
      padding: 12px;
      background: #f5f5f5;
    }
    .nav-filter button {
      flex: 1;
      padding: 12px;
      border-radius: 14px;
      border: none;
      background: #e6e6e6;
      font-size: 16px;
    }
    .nav-filter button.active {
      background: #0b57d0;
      color: white;
    }
    #product-list {
      padding: 16px;
      padding-bottom: 90px; /* supaya tidak ketutup footer */
    }
    .card {
      background: white;
      padding: 14px;
      margin-bottom: 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    .card-title {
      font-size: 18px;
      font-weight: 600;
    }
    .card-sub {
      font-size: 14px;
      margin: 6px 0;
    }
    .card button {
      background: #0b57d0;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      margin-top: 8px;
    }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #0b57d0;
      color: white;
      display: flex;
      justify-content: space-around;
      padding: 6px 0;
    }
    footer a {
      color: white;
      text-decoration: none;
      text-align: center;
      font-size: 14px;
    }
  </style>
</head>
<body>

<header>Barmods Digital Store</header>

<div class="nav-filter">
  <button class="active" onclick="changeCategory('apk', this)">Premium Apps</button>
  <button onclick="changeCategory('sosmed', this)">Sosial Media</button>
  <button onclick="changeCategory('panel', this)">Panel &amp; Tools</button>
</div>

<h3 id="title" style="padding:12px; font-size:18px;">
  Menampilkan kategori: Premium Apps
</h3>

<div id="product-list"></div>

<footer>
  <a href="index.html">üè†<br>Home</a>
  <a href="wallet.html">üí≥<br>Wallet</a>
  <a href="orders.html">üì¶<br>Pesanan</a>
  <a href="profile.html">üë§<br>Profil</a>
</footer>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // üî• KONFIG FIREBASE
  const firebaseConfig = {
    apiKey: "AIzaSyBpsfDmupS9wq-iNge5aYvknmw5bSryd3A",
    authDomain: "toko-barmods.firebaseapp.com",
    projectId: "toko-barmods",
    storageBucket: "toko-barmods.firebasestorage.app",
    messagingSenderId: "284047189012",
    appId: "1:284047189012:web:6ef0c6891adab08a383301"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Semua produk disimpan di sini
  let ALL_PRODUCTS = [];

  async function loadAllProducts() {
    const list = document.getElementById("product-list");
    list.innerHTML = "Memuat produk...";
    try {
      const snap = await getDocs(collection(db, "products"));
      ALL_PRODUCTS = [];
      snap.forEach(d => {
        ALL_PRODUCTS.push({ id: d.id, ...d.data() });
      });
      // default: Premium Apps
      renderCategory("apk");
    } catch (err) {
      list.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
    }
  }

  // logika kategori:
  // - category = "sosmed" -> tab Sosial Media
  // - category = "panel"/"tools" -> tab Panel & Tools
  // - selain itu semua -> Premium Apps
  function renderCategory(cat) {
    const list = document.getElementById("product-list");

    const filtered = ALL_PRODUCTS.filter(p => {
      const c = String(p.category || "").toLowerCase().trim();

      if (cat === "sosmed") {
        return c === "sosmed" || c === "sosial" || c === "sosmeds";
      }
      if (cat === "panel") {
        return c === "panel" || c === "tools" || c === "paneltools";
      }
      // cat === "apk" (Premium Apps) -> semua yang BUKAN sosmed / panel
      if (cat === "apk") {
        if (c === "sosmed" || c === "sosial" || c === "sosmeds") return false;
        if (c === "panel" || c === "tools" || c === "paneltools") return false;
        return true;
      }
      return true;
    });

    list.innerHTML = "";
    if (!filtered.length) {
      list.innerHTML = "<p>Tidak ada produk.</p>";
      return;
    }

    filtered.forEach(p => {
      const price = Number(p.price || 0);
      const stock = p.stock ?? 0;

      list.innerHTML += `
        <div class="card">
          <div class="card-title">${p.name || "-"}</div>
          <div class="card-sub">Harga: Rp ${price.toLocaleString("id-ID")}</div>
          <div class="card-sub">Stok: ${stock}</div>
          <button onclick="orderPage('${p.id}')">Order</button>
        </div>
      `;
    });
  }

  // fungsi dipanggil dari HTML -> taruh di window
  window.changeCategory = function (cat, btn) {
    document.querySelectorAll(".nav-filter button").forEach(b =>
      b.classList.remove("active")
    );
    if (btn) btn.classList.add("active");

    const title = document.getElementById("title");
    title.innerText =
      "Menampilkan kategori: " +
      (cat === "apk"
        ? "Premium Apps"
        : cat === "sosmed"
        ? "Sosial Media"
        : "Panel & Tools");

    renderCategory(cat);
  };

  window.orderPage = function (id) {
    // nanti bisa diarahkan ke halaman/order modal yang kamu mau
    alert("Order produk ID: " + id);
  };

  // load saat pertama kali
  loadAllProducts();
</script>

</body>
</html>
