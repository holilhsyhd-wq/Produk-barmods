<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Barmods Digital Store</title>

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    header {
      background: #0b57d0;
      padding: 16px;
      text-align: center;
      color: #fff;
      font-size: 20px;
      font-weight: 600;
    }

    /* TAB KATEGORI ATAS */
    .nav-filter {
      display: flex;
      gap: 10px;
      padding: 12px;
      background: #f5f5f5;
    }
    .nav-filter button {
      flex: 1;
      padding: 10px;
      border-radius: 999px;
      border: none;
      background: #e0e0e0;
      font-size: 14px;
    }
    .nav-filter button.active {
      background: #0b57d0;
      color: #fff;
    }

    h3#title {
      padding: 0 12px;
      margin: 0 0 8px 0;
      font-size: 16px;
    }

    #product-list {
      padding: 0 12px 90px 12px; /* 90px supaya gak ketutup footer */
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .card-sub {
      font-size: 13px;
      margin: 2px 0;
    }
    .card button {
      margin-top: 8px;
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: #0b57d0;
      color: #fff;
      font-size: 14px;
    }

    /* NAV BAWAH */
    footer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #0b57d0;
      color: #fff;
      display: flex;
      justify-content: space-around;
      padding: 4px 0 6px 0;
      z-index: 100;
    }
    footer a {
      color: #fff;
      text-decoration: none;
      text-align: center;
      font-size: 13px;
      display: block;
    }
  </style>
</head>
<body>

<header>Barmods Digital Store</header>

<div class="nav-filter">
  <button class="active" onclick="changeCategory('apk', this)">Premium Apps</button>
  <button onclick="changeCategory('sosmed', this)">Sosial Media</button>
  <button onclick="changeCategory('panel', this)">Panel &amp; Tools</button>
</div>

<h3 id="title">Menampilkan kategori: Premium Apps</h3>

<div id="product-list">Memuat produk...</div>

<footer>
  <a href="index.html">üè†<br>Home</a>
  <a href="wallet.html">üí≥<br>Wallet</a>
  <a href="orders.html">üì¶<br>Pesanan</a>
  <a href="profile.html">üë§<br>Profil</a>
</footer>

<!-- =========================================
     FIREBASE + LOGIC PRODUK
========================================= -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // KONFIG FIREBASE PUNYA KAMU
  const firebaseConfig = {
    apiKey: "AIzaSyBpsfDmupS9wq-iNge5aYvknmw5bSryd3A",
    authDomain: "toko-barmods.firebaseapp.com",
    projectId: "toko-barmods",
    storageBucket: "toko-barmods.firebasestorage.app",
    messagingSenderId: "284047189012",
    appId: "1:284047189012:web:6ef0c6891adab08a383301"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let ALL_PRODUCTS = [];

  // ambil semua produk sekali aja
  async function loadAllProducts() {
    const listEl = document.getElementById("product-list");
    listEl.textContent = "Memuat produk...";
    try {
      const snap = await getDocs(collection(db, "products"));
      ALL_PRODUCTS = [];
      snap.forEach((docSnap) => {
        const data = docSnap.data();
        ALL_PRODUCTS.push({
          id: docSnap.id,
          name: data.name || "",
          price: data.price,
          stock: data.stock ?? 0,
          category: (data.category || "").toLowerCase().trim()
        });
      });
      renderCategory("apk");
    } catch (err) {
      console.error(err);
      listEl.innerHTML = `<p style="color:red;">Gagal memuat produk: ${err.message}</p>`;
    }
  }

  // format harga: kalau number ‚Üí "Rp 2.000", kalau string ‚Üí tampil apa adanya
  function formatPrice(val) {
    if (typeof val === "number") {
      return "Rp " + val.toLocaleString("id-ID");
    }
    if (!val) return "Rp 0";
    return String(val); // misalnya "Rp 2k"
  }

  function getProductsByCategory(catKey) {
    return ALL_PRODUCTS.filter((p) => {
      const c = p.category;

      if (catKey === "sosmed") {
        return c === "sosmed" || c === "sosial" || c === "sosmeds";
      }
      if (catKey === "panel") {
        return c === "panel" || c === "tools" || c === "paneltools";
      }
      // apk = semua selain sosmed / panel
      if (catKey === "apk") {
        if (c === "sosmed" || c === "sosial" || c === "sosmeds") return false;
        if (c === "panel" || c === "tools" || c === "paneltools") return false;
        return true;
      }
      return true;
    });
  }

  function renderCategory(catKey) {
    const listEl = document.getElementById("product-list");
    const items = getProductsByCategory(catKey);

    listEl.innerHTML = "";
    if (!items.length) {
      listEl.innerHTML = "<p>Tidak ada produk.</p>";
      return;
    }

    items.forEach((p) => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="card-title">${p.name}</div>
        <div class="card-sub">Harga: ${formatPrice(p.price)}</div>
        <div class="card-sub">Stok: ${p.stock}</div>
        <button onclick="orderProduct('${p.id}')">Order</button>
      `;
      listEl.appendChild(card);
    });
  }

  // ====== FUNGSI GLOBAL UNTUK DIPAKAI DI HTML (onclick) ======
  function changeCategoryPublic(catKey, btn) {
    // ubah tombol aktif
    document.querySelectorAll(".nav-filter button").forEach((b) =>
      b.classList.remove("active")
    );
    if (btn) btn.classList.add("active");

    // ubah judul teks
    const titleEl = document.getElementById("title");
    titleEl.textContent =
      "Menampilkan kategori: " +
      (catKey === "apk"
        ? "Premium Apps"
        : catKey === "sosmed"
        ? "Sosial Media"
        : "Panel & Tools");

    renderCategory(catKey);
  }

  function orderProductPublic(id) {
    // sementara cuma log di console
    console.log("Order produk id:", id);
    // nanti bisa kamu ganti buka modal / kirim ke halaman lain
  }

  // pasang ke window supaya bisa dipanggil dari HTML
  window.changeCategory = changeCategoryPublic;
  window.orderProduct = orderProductPublic;

  // load awal
  loadAllProducts();
</script>
</body>
</html>
