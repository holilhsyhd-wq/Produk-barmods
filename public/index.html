<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Ptero Admin – Simple Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      :root {
        --bg: #020617;
        --bg-card: #020617;
        --bg-card-soft: #0f172a;
        --border-soft: #1e293b;
        --accent: #22c55e;
        --accent-soft: #166534;
        --accent-text: #bbf7d0;
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(
          circle at top,
          #1e293b 0,
          #020617 45%,
          #000 100%
        );
        color: var(--text-main);
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .main-wrapper {
        min-height: 100vh;
        display: flex;
        align-items: stretch;
      }

      .sidebar {
        width: 260px;
        padding: 24px 20px;
        border-right: 1px solid var(--border-soft);
        background: linear-gradient(
          to bottom,
          #020617aa 0,
          #020617 40%,
          #000 100%
        );
        backdrop-filter: blur(18px);
        position: sticky;
        top: 0;
        height: 100vh;
      }

      .logo-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--accent-soft);
        background: linear-gradient(135deg, #22c55e22, transparent);
        font-size: 11px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: var(--accent-text);
      }

      .logo-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--accent);
        box-shadow: 0 0 14px #22c55ecc;
      }

      .nav-title {
        margin-top: 24px;
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--text-muted);
      }

      .nav-list {
        margin-top: 10px;
        list-style: none;
        padding: 0;
      }

      .nav-item {
        margin-bottom: 4px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 10px;
        font-size: 14px;
        color: var(--text-muted);
        cursor: pointer;
        transition: background 0.15s, transform 0.1s, color 0.15s;
      }

      .nav-link.active {
        background: radial-gradient(circle at top left, #22c55e22, transparent);
        color: var(--accent-text);
        border: 1px solid #22c55e44;
      }

      .nav-link:hover {
        background: #020617;
        color: var(--text-main);
        transform: translateY(-1px);
      }

      .nav-icon {
        width: 18px;
        height: 18px;
        border-radius: 6px;
        border: 1px solid var(--border-soft);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
      }

      .main-content {
        flex: 1;
        padding: 24px 32px;
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        gap: 16px;
        align-items: center;
        margin-bottom: 24px;
      }

      .chip {
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid var(--border-soft);
        font-size: 11px;
        color: var(--text-muted);
      }

      .chip span {
        color: var(--accent-text);
      }

      .btn {
        border-radius: 999px;
        padding: 6px 14px;
        border: 1px solid transparent;
        background: #020617;
        color: var(--text-main);
        font-size: 13px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: #022c22;
        font-weight: 600;
        box-shadow: 0 12px 30px #22c55e3d;
      }

      .btn-outline {
        border-color: var(--border-soft);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .grid {
        display: grid;
        gap: 16px;
      }

      .grid-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .card {
        background: radial-gradient(circle at top left, #1e293b66, #020617 55%);
        border-radius: 20px;
        padding: 18px 16px;
        border: 1px solid #1e293b;
        box-shadow: 0 18px 50px #00000088;
      }

      .card-soft {
        background: #020617;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 8px;
        margin-bottom: 12px;
      }

      .card-title {
        font-size: 14px;
        color: var(--text-muted);
      }

      .card-value {
        font-size: 20px;
        font-weight: 600;
      }

      .card-pill {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        background: #0f172a;
        color: var(--text-muted);
      }

      .table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }

      .table thead {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: var(--text-muted);
      }

      .table th,
      .table td {
        padding: 8px 10px;
        border-bottom: 1px solid #111827;
      }

      .badge {
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
      }

      .badge-muted {
        background: #1e293b;
        color: #9ca3af;
      }

      .input-group {
        display: flex;
        gap: 8px;
        margin-top: 8px;
      }

      .input {
        flex: 1;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid #1e293b;
        background: #020617;
        color: var(--text-main);
        font-size: 13px;
      }

      .text-xs {
        font-size: 11px;
        color: var(--text-muted);
      }

      .error-box {
        border-radius: 16px;
        padding: 10px 12px;
        border: 1px solid #b91c1c88;
        background: linear-gradient(135deg, #450a0a, #020617 60%, #000 100%);
        margin-bottom: 16px;
        font-size: 13px;
        color: #fecaca;
      }

      @media (max-width: 900px) {
        .main-wrapper {
          flex-direction: column;
        }

        .sidebar {
          position: static;
          width: 100%;
          height: auto;
          border-right: none;
          border-bottom: 1px solid var(--border-soft);
        }

        .main-content {
          padding: 16px;
        }

        .grid-3,
        .grid-2 {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-wrapper">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="logo-badge">
          <span class="logo-dot"></span>
          Ptero Admin
        </div>

        <div style="margin-top: 18px; font-size: 20px; font-weight: 600">
          Control Center
        </div>
        <div style="font-size: 12px; color: #9ca3af; margin-top: 4px">
          Monitoring & quick actions untuk panel Pterodactyl kamu.
        </div>

        <div class="nav-title">Navigation</div>
        <ul class="nav-list">
          <li class="nav-item">
            <div class="nav-link active">
              <div class="nav-icon">◦</div>
              Overview
            </div>
          </li>
          <li class="nav-item">
            <div class="nav-link">
              <div class="nav-icon">◎</div>
              Servers
            </div>
          </li>
          <li class="nav-item">
            <div class="nav-link">
              <div class="nav-icon">⚙</div>
              Settings
            </div>
          </li>
        </ul>
      </aside>

      <!-- MAIN -->
      <main class="main-content">
        <header class="content-header">
          <div>
            <div class="chip">
              Linked to <span>Pterodactyl API (Application)</span>
            </div>
            <h1 style="margin: 8px 0 4px; font-size: 26px">
              Game & Bot server control at a glance
            </h1>
            <p style="font-size: 13px; color: #9ca3af">
              Monitor, refresh, dan buat server baru (termasuk Panel Bot-WA)
              langsung dari satu halaman.
            </p>
          </div>

          <div style="display: flex; flex-direction: column; gap: 8px">
            <div style="display: flex; gap: 8px">
              <button class="btn btn-outline" id="btn-refresh">
                ⟳ Refresh servers
              </button>
              <button class="btn btn-primary" id="btn-create-manual">
                Create Server Manual
              </button>
            </div>
            <button class="btn btn-primary" id="btn-create-botwa">
              ⚡ 1-Click Create Panel Bot-WA
            </button>
          </div>
        </header>

        <div id="error-box" class="error-box" style="display: none"></div>

        <!-- STATS -->
        <section class="grid grid-3" style="margin-bottom: 18px">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Total Servers</div>
                <div class="card-value" id="stat-total">0</div>
              </div>
              <div class="card-pill">All Wings</div>
            </div>
            <div class="text-xs">
              Jumlah server yang terbaca dari Application API Pterodactyl.
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Online (dummy)</div>
                <div class="card-value" id="stat-online">0</div>
              </div>
              <div class="card-pill">Mode demo</div>
            </div>
            <div class="text-xs">
              Kalau kamu punya field status, bisa di-mapping ke sini.
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Bot-WA Preset</div>
                <div class="card-value">1-click</div>
              </div>
              <div class="card-pill">Panel Bot-WA</div>
            </div>
            <div class="text-xs">
              Tombol khusus buat bikin server Panel Bot-WA dengan konfigurasi
              template di backend Pterodactyl kamu.
            </div>
          </div>
        </section>

        <!-- BODY GRID -->
        <section class="grid grid-2">
          <!-- LIST SERVER -->
          <div class="card card-soft">
            <div class="card-header">
              <div>
                <div class="card-title">Servers</div>
                <div
                  id="label-servers"
                  style="font-size: 12px; color: #9ca3af"
                >
                  Loading...
                </div>
              </div>
            </div>

            <div style="overflow-x: auto">
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>External ID</th>
                    <th>User</th>
                    <th>Status*</th>
                  </tr>
                </thead>
                <tbody id="servers-tbody"></tbody>
              </table>
            </div>

            <div class="text-xs" style="margin-top: 8px">
              *Status masih placeholder. Untuk realtime status gunakan Client
              API <code>/api/client/servers/:id/resources</code> + WebSocket.
            </div>
          </div>

          <!-- FORM CREATE MANUAL -->
          <div class="card card-soft">
            <div class="card-header">
              <div>
                <div class="card-title">Create Server Manual</div>
                <div style="font-size: 12px; color: #9ca3af">
                  Skeleton minimal, konfigurasi user / egg / allocation diubah
                  di script ini.
                </div>
              </div>
              <button class="btn btn-outline" id="btn-fill-demo">
                Fill demo
              </button>
            </div>

            <label class="text-xs">Server name</label>
            <div class="input-group">
              <input
                class="input"
                id="input-name"
                placeholder="contoh: Survival #1"
              />
            </div>

            <label class="text-xs" style="margin-top: 12px">
              External ID (opsional)
            </label>
            <div class="input-group">
              <input
                class="input"
                id="input-external"
                placeholder="boleh dikosongkan"
              />
            </div>

            <div
              class="text-xs"
              style="margin-top: 12px; line-height: 1.5; opacity: 0.9"
            >
              Detail <b>user</b>, <b>egg</b>, <b>limits</b>, dan
              <b>allocation</b> diatur di dalam script (bagian komentar CAPS).
              <br />
              Sesuaikan dengan konfigurasi panel dan egg Pterodactyl kamu.
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- ======================== SCRIPT LOGIC ======================== -->
    <script>
      /************************************************************
       *  KONFIGURASI PTERODACTYL – GANTI BAGIAN INI
       ************************************************************/
      const PTERO_BASE_URL = "https://zeroix.publik.xpanelprivate.my.id"; // GANTI
      const PTERO_API_KEY = "ptla_koDwodlNIKP6gMlOsWlFMsZUAJJTk31WGyRXRDVZ1Wc"; // GANTI – JANGAN PAKAI KEY PENTING DI PUBLIK

      // Setting default untuk server biasa (manual)
      const DEFAULT_USER_ID = 15; // GANTI: id user yang punya server
      const DEFAULT_EGG_ID = 15; // GANTI: id egg default
      const DEFAULT_ALLOCATION_ID = 1; // GANTI: allocation id valid

      // Setting khusus panel BOT-WA
      const BOTWA_USER_ID = 15; // GANTI kalau mau user tertentu
      const BOTWA_EGG_ID = 15; // GANTI: id egg Bot-WA / panel bot
      const BOTWA_ALLOCATION_ID = 1; // GANTI: allocation id buat Bot-WA

      /************************************************************
       *  UTIL
       ************************************************************/
      const serversTbody = document.getElementById("servers-tbody");
      const labelServers = document.getElementById("label-servers");
      const statTotal = document.getElementById("stat-total");
      const statOnline = document.getElementById("stat-online");
      const errorBox = document.getElementById("error-box");

      const inputName = document.getElementById("input-name");
      const inputExternal = document.getElementById("input-external");

      const btnRefresh = document.getElementById("btn-refresh");
      const btnCreateManual = document.getElementById("btn-create-manual");
      const btnCreateBotWa = document.getElementById("btn-create-botwa");
      const btnFillDemo = document.getElementById("btn-fill-demo");

      function showError(message, detail) {
        errorBox.style.display = "block";
        errorBox.innerHTML =
          "⚠ " +
          message +
          (detail ? "<br/><span class='text-xs'>" + detail + "</span>" : "");
      }

      function clearError() {
        errorBox.style.display = "none";
        errorBox.innerHTML = "";
      }

      /************************************************************
       *  LOAD SERVERS
       ************************************************************/
      async function loadServers() {
        clearError();
        labelServers.textContent = "Loading...";
        serversTbody.innerHTML = "";

        try {
          const res = await fetch(PTERO_BASE_URL + "/api/application/servers", {
            method: "GET",
            headers: {
              Authorization: "Bearer " + PTERO_API_KEY,
              "Content-Type": "application/json",
              Accept: "Application/vnd.pterodactyl.v1+json",
            },
          });

          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (e) {
            showError("Gagal parse response server.", text);
            labelServers.textContent = "Error saat load.";
            return;
          }

          if (!res.ok) {
            showError("Gagal ambil data dari Pterodactyl.", text);
            labelServers.textContent = "Error saat load.";
            return;
          }

          const list = data.data || [];
          labelServers.textContent = `Showing ${list.length} servers`;
          statTotal.textContent = String(list.length);

          // dummy online = 0 (kamu bisa custom sendiri)
          statOnline.textContent = "0";

          if (list.length === 0) {
            serversTbody.innerHTML =
              '<tr><td colspan="5" style="padding-top: 16px; font-size: 13px;">Belum ada server yang ditampilkan.</td></tr>';
            return;
          }

          serversTbody.innerHTML = "";
          list.forEach((s) => {
            const attr = s.attributes || {};
            const tr = document.createElement("tr");

            tr.innerHTML =
              "<td>" +
              (attr.id ?? "") +
              "</td>" +
              "<td>" +
              (attr.name ?? "") +
              "</td>" +
              "<td>" +
              (attr.external_id ||
                '<span class="badge badge-muted">none</span>') +
              "</td>" +
              "<td>" +
              (attr.user ?? "") +
              "</td>" +
              '<td><span class="badge badge-muted">unknown</span></td>';

            serversTbody.appendChild(tr);
          });
        } catch (e) {
          console.error(e);
          showError("Error jaringan saat load server.", String(e));
          labelServers.textContent = "Error saat load.";
        }
      }

      /************************************************************
       *  CREATE SERVER – MANUAL
       ************************************************************/
      async function createServerManual() {
        clearError();

        const name = inputName.value.trim();
        const externalId = inputExternal.value.trim() || null;

        if (!name) {
          showError("Nama server wajib diisi.");
          return;
        }

        btnCreateManual.disabled = true;

        // body create server – SESUAIKAN DENGAN PANELMU
        const body = {
          name: name,
          description: "Created from simple admin panel",
          external_id: externalId,

          user: DEFAULT_USER_ID,
          egg: DEFAULT_EGG_ID,
          docker_image: "ghcr.io/parkervcp/yolks:nodejs_18", // contoh

          startup: "npm start",

          environment: {
            // Contoh env; sesuaikan sama egg kamu
            // "PORT": "3000",
          },

          limits: {
            memory: 1024,
            swap: 0,
            disk: 5120,
            io: 500,
            cpu: 0,
          },

          feature_limits: {
            databases: 1,
            backups: 1,
            allocations: 1,
          },

          allocation: {
            default: DEFAULT_ALLOCATION_ID,
          },
        };

        try {
          const res = await fetch(
            PTERO_BASE_URL + "/api/application/servers",
            {
              method: "POST",
              headers: {
                Authorization: "Bearer " + PTERO_API_KEY,
                "Content-Type": "application/json",
                Accept: "Application/vnd.pterodactyl.v1+json",
              },
              body: JSON.stringify(body),
            }
          );

          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (e) {
            showError("Gagal parse response create server.", text);
            return;
          }

          if (!res.ok) {
            console.error(data);
            showError(
              "Gagal membuat server manual. Cek konfigurasi user/egg/allocation.",
              JSON.stringify(data)
            );
            return;
          }

          // sukses
          inputName.value = "";
          inputExternal.value = "";
          await loadServers();
        } catch (e) {
          console.error(e);
          showError("Error jaringan saat create server.", String(e));
        } finally {
          btnCreateManual.disabled = false;
        }
      }

      /************************************************************
       *  CREATE SERVER BOT-WA (PRESET)
       ************************************************************/
      async function createServerBotWa() {
        clearError();
        btnCreateBotWa.disabled = true;

        const body = {
          name: "Panel Bot-WA",
          description: "Server untuk panel bot WhatsApp (preset simple)",
          external_id: null,

          user: BOTWA_USER_ID,
          egg: BOTWA_EGG_ID,
          docker_image: "ghcr.io/parkervcp/yolks:nodejs_18", // umumnya NodeJS

          startup: "npm start", // ganti sesuai dok egg Bot-WA

          environment: {
            // Contoh env – GANTI sesuai egg:
            // "BOT_NUMBER": "628xxxxx",
            // "API_KEY": "xxxx",
            // "MONGODB_URI": "mongodb+srv://....",
          },

          limits: {
            memory: 2048,
            swap: 0,
            disk: 10240,
            io: 500,
            cpu: 0,
          },

          feature_limits: {
            databases: 1,
            backups: 3,
            allocations: 1,
          },

          allocation: {
            default: BOTWA_ALLOCATION_ID,
          },
        };

        try {
          const res = await fetch(
            PTERO_BASE_URL + "/api/application/servers",
            {
              method: "POST",
              headers: {
                Authorization: "Bearer " + PTERO_API_KEY,
                "Content-Type": "application/json",
                Accept: "Application/vnd.pterodactyl.v1+json",
              },
              body: JSON.stringify(body),
            }
          );

          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (e) {
            showError(
              "Gagal parse response create server Bot-WA.",
              text
            );
            return;
          }

          if (!res.ok) {
            console.error(data);
            showError(
              "Gagal membuat server Panel Bot-WA. Cek ID egg/user/allocation & env.",
              JSON.stringify(data)
            );
            return;
          }

          await loadServers();
        } catch (e) {
          console.error(e);
          showError("Error jaringan saat create server Bot-WA.", String(e));
        } finally {
          btnCreateBotWa.disabled = false;
        }
      }

      /************************************************************
       *  EVENT LISTENERS
       ************************************************************/
      btnRefresh.addEventListener("click", loadServers);
      btnCreateManual.addEventListener("click", createServerManual);
      btnCreateBotWa.addEventListener("click", createServerBotWa);

      btnFillDemo.addEventListener("click", () => {
        inputName.value = "My new server";
        inputExternal.value = "external-" + Date.now();
      });

      // load awal
      loadServers();
    </script>
  </body>
</html>
