<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Barmods Store</title>

    <!-- STYLE MODERN -->
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: radial-gradient(circle at top, #0d1b3d, #000814);
            color: white;
        }
        .header {
            padding: 20px;
            background: rgba(0, 20, 60, 0.6);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .saldo-box {
            background: #071b3b;
            margin: 20px;
            padding: 20px;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .kategori-btn {
            display: flex;
            gap: 10px;
            padding: 0 20px;
        }
        .kategori-btn button {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 15px;
            color: white;
            border-radius: 12px;
            cursor: pointer;
        }
        .produk-list {
            padding: 20px;
        }
        .produk-item {
            background: #081a35;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .produk-item .info {
            max-width: 70%;
        }
        .produk-item button {
            background: #00d967;
            color: black;
            font-weight: bold;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #051229;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>

<body>

    <!-- HEADER -->
    <div class="header">
        <h2>Barmods Store</h2>
        <p>Topup & premium service dalam satu panel.</p>
    </div>

    <!-- SALDO USER -->
    <div class="saldo-box">
        <div>
            <p>SALDO KAMU</p>
            <h1 id="saldoUser">Rp 0</h1>
        </div>
        <button style="background:#1134a6; color:white; padding:10px 20px; border-radius:20px;">
            âš¡ Topup Saldo
        </button>
    </div>

    <!-- KATEGORI -->
    <div class="kategori-btn">
        <button onclick="filterProduk('all')">Semua</button>
        <button onclick="filterProduk('premium')">Premium</button>
        <button onclick="filterProduk('sosmed')">Sosmed</button>
        <button onclick="filterProduk('panel')">Panel</button>
    </div>

    <!-- DAFTAR PRODUK -->
    <div class="produk-list" id="produkList">
        Memuat produk...
    </div>

    <!-- NAV BAWAH -->
    <div class="bottom-nav">
        <span>Produk</span>
        <span>Wallet</span>
        <span>Orders</span>
        <span>Profile</span>
    </div>

    <!-- FIREBASE IMPORT -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        /* ============================
           FIREBASE CONFIG (ISI LENGKAP)
           ============================ */

        const firebaseConfig = {
            apiKey: "AIzaSyBpsfDmupS9wq-iNge5aYvknmw5bSryd3A",
            authDomain: "toko-barmods.firebaseapp.com",
            projectId: "toko-barmods",
            storageBucket: "toko-barmods.firebasestorage.app",
            messagingSenderId: "284047189012",
            appId: "1:284047189012:web:6ef0c6891adab08a383301"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /* ============================
           MEMUAT PRODUK
           ============================ */

        let semuaProduk = [];

        async function loadProduk() {
            const container = document.getElementById("produkList");
            container.innerHTML = "Memuat produk...";

            const snap = await db.collection("produk").orderBy("nama").get();

            semuaProduk = [];
            snap.forEach(doc => {
                semuaProduk.push({ id: doc.id, ...doc.data() });
            });

            tampilkanProduk("all");
        }

        function filterProduk(kat) {
            tampilkanProduk(kat);
        }

        function tampilkanProduk(kategori) {
            const container = document.getElementById("produkList");
            container.innerHTML = "";

            const filtered = kategori === "all"
                ? semuaProduk
                : semuaProduk.filter(p => p.kategori === kategori);

            if (filtered.length === 0) {
                container.innerHTML = "<p>Tidak ada produk.</p>";
                return;
            }

            filtered.forEach(p => {
                container.innerHTML += `
                <div class="produk-item">
                    <div class="info">
                        <b>${p.nama}</b><br>
                        <small>Kategori: ${p.kategori}</small><br>
                        <small>Rp ${p.harga.toLocaleString("id-ID")}</small><br>
                        <small><b>Stok: ${p.stok}</b></small>
                    </div>
                    <button onclick="beliProduk('${p.id}')">Beli</button>
                </div>`;
            });
        }

        /* ============================
           BELI PRODUK + KURANGI STOK
           ============================ */

        async function beliProduk(id) {
            const ref = db.collection("produk").doc(id);
            const data = await ref.get();

            if (!data.exists) return alert("Produk tidak ditemukan!");

            const produk = data.data();

            if (produk.stok <= 0) return alert("Stok habis!");

            if (confirm(`Beli ${produk.nama} seharga Rp ${produk.harga}?`)) {

                await db.collection("orders").add({
                    produkID: id,
                    nama: produk.nama,
                    harga: produk.harga,
                    tanggal: new Date().toLocaleString(),
                    status: "pending"
                });

                // Kurangi stok otomatis
                await ref.update({
                    stok: produk.stok - 1
                });

                alert("Pesanan berhasil dibuat!");
                loadProduk();
            }
        }

        /* ============================
           LOAD AWAL
           ============================ */
        loadProduk();
    </script>

</body>
</html>
