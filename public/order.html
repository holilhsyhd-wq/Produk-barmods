<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pesanan Saya - Barmods Digital Store</title>

<style>
  body {
    margin: 0;
    background: #0f0f17;
    color: #fff;
    font-family: Arial, sans-serif;
  }

  header {
    padding: 16px;
    background: #141421;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .btn-header {
    color: #fff;
    background: #303043;
    padding: 6px 12px;
    border-radius: 8px;
    text-decoration: none;
  }

  h2 {
    text-align: center;
    padding: 12px;
    margin: 0;
  }

  .order-list {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .order-card {
    background: #181828;
    padding: 14px;
    border-radius: 12px;
  }

  .status {
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 13px;
    display: inline-block;
  }

  .pending { background: #f9a825; color: #000; }
  .process { background: #42a5f5; color: #000; }
  .success { background: #66bb6a; color: #000; }
  .error   { background: #ef5350; color: #000; }

  .proof-img {
    margin-top: 8px;
    width: 90px;
    height: 90px;
    border-radius: 6px;
    object-fit: cover;
    border: 1px solid #333;
  }

  .product-box {
    margin-top: 10px;
    background: #222234;
    padding: 10px;
    border-radius: 8px;
  }
</style>
</head>

<body>

<header>
  <div><b>Barmods Digital Store</b></div>
  <a href="index.html" class="btn-header">Kembali</a>
</header>

<h2>Pesanan Saya</h2>

<div id="orderList" class="order-list"></div>

<!-- ========================= -->
<!-- FIREBASE SCRIPT           -->
<!-- ========================= -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore, collection, query, where, onSnapshot
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import {
    getAuth, onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBpsf...

(continue the config you already use)

    messagingSenderId: "284047189012",
    appId: "1:284047189012:web:6ef0c6891adab08a383301"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);
  const auth = getAuth(app);

  const list = document.getElementById("orderList");

  // CEK LOGIN USER
  onAuthStateChanged(auth, (user)=>{
    if (!user){
      window.location.href = "login.html";
      return;
    }

    loadOrders(user.uid);
  });

  // AMBIL PESANAN USER
  function loadOrders(uid){
    const q = query(
      collection(db, "orders"),
      where("userUid", "==", uid)
    );

    onSnapshot(q, (snap)=>{
      list.innerHTML = "";

      if (snap.empty){
        list.innerHTML = "<p style='text-align:center;color:#777;'>Belum ada pesanan.</p>";
        return;
      }

      snap.forEach(docSnap=>{
        const d = docSnap.data();

        const card = document.createElement("div");
        card.className = "order-card";

        let statusClass =
          d.status === "pending" ? "pending" :
          d.status === "proses"  ? "process" :
          d.status === "sukses"  ? "success" :
          "error";

        card.innerHTML = `
          <div><b>${d.productName}</b></div>
          <div>Harga: ${d.price}</div>
          <div>Tanggal: ${new Date(d.createdAt).toLocaleString()}</div>
          <div class="status ${statusClass}" style="margin-top:6px;">
            Status: ${d.status}
          </div>

          ${
            d.proofUrl
            ? `<div><img class="proof-img" src="${d.proofUrl}"></div>`
            : ""
          }

          ${
            d.adminProduct
            ? `
              <div class="product-box">
                <b>Produk dari admin:</b><br>
                ${d.adminProduct}
              </div>
            `
            : ""
          }
        `;

        list.appendChild(card);
      });
    });
  }
</script>

</body>
</html>
