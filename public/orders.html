<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Orders - Barmods Store</title>

<style>
  body{
    font-family:sans-serif;
    margin:0;
    background:#0d1117;
    color:white;
    padding-bottom:80px;
  }
  h1{text-align:center;margin:20px 0;font-size:22px;}

  .card{
    background:#161b22;
    margin:12px;
    padding:15px;
    border-radius:14px;
    box-shadow:0 0 12px rgba(0,0,0,0.4);
  }

  .status{
    font-weight:bold;
    padding:4px 8px;
    border-radius:6px;
    display:inline-block;
    margin-top:6px;
  }

  .pending{background:#fbbf24;color:black;}
  .process{background:#60a5fa;color:black;}
  .success{background:#4ade80;color:black;}

  .nav{
    position:fixed;bottom:0;left:0;right:0;
    background:#161b22;
    display:flex;
    justify-content:space-around;
    padding:10px 0;
    box-shadow:0 -4px 12px rgba(0,0,0,0.4);
  }
  .nav a{color:#58a6ff;text-decoration:none;font-size:14px;}

  .small{color:#9ca3af;font-size:13px;}
</style>
</head>
<body>

<h1>Daftar Pesanan</h1>

<div id="orders"></div>

<div class="nav">
  <a href="index.html">Produk</a>
  <a href="wallet.html">Wallet</a>
  <a href="orders.html">Orders</a>
  <a href="profile.html">Profile</a>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<script>
// FIREBASE INIT
const firebaseConfig={
  apiKey:"AIzaSyBpsfDmupS9wq-iNge5aYvknmw5bSryd3A",
  authDomain:"toko-barmods.firebaseapp.com",
  projectId:"toko-barmods"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

auth.onAuthStateChanged(u=>{
  if(!u) return location.href="login.html";
  loadOrders();
});

// ========================
// LOAD ALL ORDERS FOR USER
// ========================
function loadOrders(){
  const uid = auth.currentUser.uid;
  const container = document.getElementById("orders");
  container.innerHTML = "<div class='card'>Memuat pesanan...</div>";

  db.collection("orders").where("userId","==",uid).get()
  .then(q=>{
    if(q.empty){
      container.innerHTML = "<div class='card'>Belum ada pesanan.</div>";
      return;
    }

    // sort manual by createdAt desc
    const arr=[];
    q.forEach(doc=>{
      arr.push({id:doc.id, ...doc.data()});
    });
    arr.sort((a,b)=> (b.createdAt||0) - (a.createdAt||0));

    container.innerHTML="";
    arr.forEach(o=>{
      const st = o.status || "pending";
      let stClass = (st==="pending") ? "pending"
                 : (st==="process") ? "process"
                 : "success";

      const tanggal = o.createdAt
        ? new Date(o.createdAt).toLocaleString("id-ID")
        : "-";

      container.innerHTML += `
        <div class="card">
          <b>${o.productName}</b><br>
          <div class="small">Tanggal: ${tanggal}</div>

          <div class="status ${stClass}">${st.toUpperCase()}</div>

          <div style="margin-top:10px;">
            <div class="small">Harga: Rp ${Number(o.price||0).toLocaleString("id-ID")}</div>
          </div>

          <div style="margin-top:10px;">
            <b>Data yang kamu kirim:</b><br>
            <div class="small">${o.inputUser || "-"}</div>
          </div>

          <div style="margin-top:10px;">
            <b>Produk dari admin:</b><br>
            <div class="small">${o.adminProduct || "<i>Belum dikirim</i>"}</div>
          </div>
        </div>
      `;
    });
  })
  .catch(err=>{
    container.innerHTML = "<div class='card'>Gagal load orders: "+err.message+"</div>";
  });
}
</script>

</body>
</html>
